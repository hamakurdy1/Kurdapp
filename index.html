<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¬Ù„ Ùˆ Ø±Ø³Ù… Ø¨ÛŒØ§Ù†ÛŒ Ø´Û•Ú©Ø±Û•</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial,sans-serif; background:#f0f4f8; margin:0; padding:10px; color:#333; }
h1 { text-align:center; font-size:1.3rem; margin-bottom:10px; }
.container { max-width:400px; margin:auto; background:white; padding:10px; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
label, select, input { width:100%; margin-bottom:0.5rem; font-size:0.85rem; }
input, select { padding:0.3rem; border:1px solid #ccc; border-radius:5px; }
.btn { background:#3498db; color:white; border:none; padding:0.5rem; width:100%; border-radius:5px; font-size:0.85rem; margin-top:0.3rem; cursor:pointer; }
.btn:active { transform:scale(0.97); opacity:0.85; }
.btn.delete-all { background:#e74c3c; margin-top:0.3rem; }
.records { margin-top:5px; max-height:200px; overflow-y:auto; }
.record { padding:0.4rem; border-bottom:1px solid #ddd; font-size:0.8rem; position:relative; }
.record span { display:block; }
.low { color:orange; } .prediabetes { color:#d35400; } .normal { color:green; } .high { color:red; }
.delete-single { position:absolute; left:5px; top:5px; background:#e74c3c; color:white; border:none; border-radius:3px; padding:0.2rem 0.4rem; font-size:0.7rem; cursor:pointer; }
canvas { margin-top:10px; }
</style>
</head>
<body>
<div class="container">
<h1>Ø³Ø¬Ù„ Ø´Û•Ú©Ø±Û• Ùˆ Ø±Ø³Ù… Ø¨ÛŒØ§Ù†ÛŒ</h1>

<label>Ø´Û•Ú©Ø±Û•Øª Ù‡Û•ÛŒÛ•ØŸ</label>
<select id="personType"><option value="diabetic">Ø¨Û•ÚµÛ</option><option value="healthy">Ù†Û•Ø®ÛØ±</option></select>

<label>Ø¨Û•(mg/dL) Ø¨Ù†ÙˆÙˆØ³Ù‡</label>
<input type="number" id="sugar" placeholder="Ù…Ø«Ø§Ù„: 110">

<label>Ø¯Û†Ø®</label>
<select id="type"><option value="fasting">Ø¨Û•Ú•Û†Ú˜ÙˆÙˆØ¨ÙˆÙˆÙ†</option><option value="postmeal">Ø¯ÙˆÙˆÚ©Ø§ØªÚ˜Ù…ÛØ± Ø¯ÙˆØ§ÛŒ Ù†Ø§Ù†</option></select>

<button class="btn" onclick="saveReading()">ğŸ’¾ Ù‡Û•ÚµÚ¯Ø±Ø¯Ù†</button>
<button class="btn delete-all" onclick="clearAll()">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>

<div class="records" id="records"></div>

<canvas id="sugarChart" height="150"></canvas>
</div>

<script>
const sugarInput=document.getElementById("sugar");
const typeInput=document.getElementById("type");
const personTypeInput=document.getElementById("personType");
const recordsDiv=document.getElementById("records");
const ctx=document.getElementById("sugarChart").getContext("2d");

let chart;

function getClassification(value,type,personType){
value=parseInt(value);
let result='';
if(personType==="healthy"){
if(type==="fasting"){ if(value<70)result="low"; else if(value<=99)result="normal"; else if(value<=125)result="prediabetes"; else result="high"; }
else{ if(value<70)result="low"; else if(value<140)result="normal"; else if(value<=199)result="prediabetes"; else result="high"; }
}else{
if(type==="fasting"){ if(value<80)result="low"; else if(value<=130)result="normal"; else result="high"; }
else{ if(value<80)result="low"; else if(value<=180)result="normal"; else result="high"; }
}
return result;
}

function saveReading(){
const value=sugarInput.value.trim();
const type=typeInput.value;
const personType=personTypeInput.value;
if(!value){alert("ØªÚ©Ø§ÛŒÙ‡ Ú•ÛÚ˜Û•Ú©Û• Ø¨Ù†ÙˆÙˆØ³Û•"); return;}
if(value<20||value>600){alert("ØªÚ©Ø§ÛŒÙ‡ Ú•ÛÚ˜Û•Ú©Û• Ù„Û•Ù†ÛÙˆØ§Ù† 20 Ùˆ 600 Ø¨Ù†ÙˆÙˆØ³Ù‡"); return;}
const date=new Date().toLocaleString("ar-EG");
const classification=getClassification(value,type,personType);
const record={value,date,classification};
let readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
readings.push(record);
localStorage.setItem("sugarReadings",JSON.stringify(readings));
sugarInput.value="";
showReadings();
updateChart();
}

function showReadings(){
const readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
recordsDiv.innerHTML="";
readings.slice().reverse().forEach((r,i)=>{
const div=document.createElement("div");
div.className="record "+r.classification;
div.innerHTML=`<span><strong>${r.value} mg/dL</strong></span><span>ğŸ“… ${r.date}</span><span>${r.classification==="low"?"ğŸŸ  Ù†Ø²Ù…":r.classification==="normal"?"ğŸŸ¢ Ø¦Ø§Ø³Ø§ÛŒÛŒ":r.classification==="prediabetes"?"âš ï¸ Ù¾ÛØ´ Ø´Û•Ú©Ø±Û•":"ğŸ”´ Ø¨Û•Ø±Ø²"}</span><button class="delete-single" onclick="deleteReading(${readings.length-1-i})">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>`;
recordsDiv.appendChild(div);
});
}

function deleteReading(index){
let readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
readings.splice(index,1);
localStorage.setItem("sugarReadings",JSON.stringify(readings));
showReadings();
updateChart();
}

function clearAll(){
if(confirm("Ø¦Ø§ÛŒÙ‡ ØªÛ† Ø¯ÚµÙ†ÛŒØ§ÛŒÛŒ Ù„Û•Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ØªÛ•ÙˆØ§ÙˆÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†ØŸ")){
localStorage.removeItem("sugarReadings");
showReadings();
updateChart();
}
}

function updateChart(){
const readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
const labels=readings.map(r=>r.date);
const data=readings.map(r=>r.value);
if(chart) chart.destroy();
chart=new Chart(ctx,{
type:'line',
data:{labels, datasets:[{label:'Ù†Ø³Ø¨Ù‡ Ø´Û•Ú©Ø±Û•', data, borderColor:'#3498db', backgroundColor:'rgba(52,152,219,0.2)', fill:true, tension:0.3}]},
options:{responsive:true, scales:{x:{display:true}, y:{display:true, beginAtZero:false}}}
});
}

showReadings();
updateChart();
</script>
</body>
</html>
