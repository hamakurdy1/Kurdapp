<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªÛ†Ù…Ø§Ø±ÛŒ Ø´Û•Ú©Ø±Û• â€“ Ø¥ØµØ¯Ø§Ø± Ø­Ø¯ÙŠØ«</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      margin: 0;
      padding: 1rem;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #00796b;
      margin-bottom: 1rem;
      font-size: 1.8rem;
      text-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .container {
      max-width: 550px;
      margin: auto;
      background: #ffffffcc;
      padding: 1.5rem;
      border-radius: 1.2rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    label, select, input {
      display: block;
      width: 100%;
      margin-bottom: 0.8rem;
      font-size: 1rem;
    }

    input, select {
      padding: 0.7rem;
      border: 1px solid #b2dfdb;
      border-radius: 0.7rem;
      transition: all 0.2s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #00796b;
      box-shadow: 0 0 8px rgba(0,121,107,0.3);
    }

    .btn {
      background-color: #00796b;
      color: white;
      border: none;
      padding: 0.9rem;
      width: 100%;
      border-radius: 0.8rem;
      font-size: 1.1rem;
      margin-top: 0.5rem;
      transition: all 0.3s ease-in-out;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #004d40;
      transform: translateY(-2px);
    }

    .btn:active {
      transform: scale(0.97);
      opacity: 0.9;
    }

    .btn.delete-all {
      background-color: #d32f2f;
    }

    .btn.delete-all:hover {
      background-color: #b71c1c;
    }

    .records {
      margin-top: 1.5rem;
    }

    .record {
      background: #e0f2f1;
      padding: 1rem;
      border-radius: 0.8rem;
      margin-bottom: 0.8rem;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }

    .record:hover {
      transform: translateY(-2px);
    }

    .record span {
      display: block;
      margin-bottom: 0.3rem;
    }

    .low { color: #f57c00; font-weight: bold; }
    .prediabetes { color: #e65100; font-weight: bold; }
    .normal { color: #2e7d32; font-weight: bold; }
    .high { color: #c62828; font-weight: bold; }

    .delete-single {
      position: absolute;
      left: 10px;
      top: 10px;
      background: #c62828;
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .delete-single:hover {
      background: #b71c1c;
      transform: scale(1.05);
    }

    canvas {
      margin-top: 2rem;
      border-radius: 1rem;
      background: #ffffffdd;
      padding: 1rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ØªÛ†Ù…Ø§Ø±ÛŒ Ø´Û•Ú©Ø±Û•ÛŒ Ø®ÙˆÛÙ†</h1>

    <label>Ø´Û•Ú©Ø±Û•Øª Ù‡Û•ÛŒÛ•ØŸ:</label>
    <select id="personType">
      <option value="diabetic">Ø¨Û•ÚµÛ</option>
      <option value="healthy">Ù†Û•Ø®ÛØ±</option>
    </select>

    <label>Ø¨Û•(mg/dL) Ø¨Ù†ÙˆÙˆØ³Ù‡:</label>
    <input type="number" id="sugar" placeholder="Ù†Ù…ÙˆÙˆÙ†Û•: 110" />

    <label>Ø¯Û†Ø®:</label>
    <select id="type">
      <option value="fasting">Ø¨Û•Ú•Û†Ú˜ÙˆÙˆØ¨ÙˆÙˆÙ†</option>
      <option value="postmeal">Ø¯ÙˆÙˆÚ©Ø§ØªÚ˜Ù…ÛØ± Ø¯ÙˆØ§ÛŒ Ù†Ø§Ù†</option>
    </select>

    <button class="btn" onclick="saveReading()">ğŸ’¾ Ù‡Û•ÚµÚ¯Ø±Ø¯Ù†</button>
    <button class="btn delete-all" onclick="clearAll()">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†</button>

    <div class="records" id="records"></div>

    <canvas id="sugarChart" width="400" height="250"></canvas>
  </div>

  <script>
    const sugarInput = document.getElementById("sugar");
    const typeInput = document.getElementById("type");
    const personTypeInput = document.getElementById("personType");
    const recordsDiv = document.getElementById("records");
    const ctx = document.getElementById('sugarChart').getContext('2d');

    let chart;

    function getClassification(value, type, personType) {
      value = parseInt(value);
      let result = '';

      if (personType === "healthy") {
        if (type === "fasting") {
          if (value < 70) result = "low";
          else if (value <= 99) result = "normal";
          else if (value <= 125) result = "prediabetes";
          else result = "high";
        } else {
          if (value < 70) result = "low";
          else if (value < 140) result = "normal";
          else if (value <= 199) result = "prediabetes";
          else result = "high";
        }
      } else {
        if (type === "fasting") {
          if (value < 80) result = "low";
          else if (value <= 130) result = "normal";
          else result = "high";
        } else {
          if (value < 80) result = "low";
          else if (value <= 180) result = "normal";
          else result = "high";
        }
      }
      return result;
    }

    function saveReading() {
      const value = sugarInput.value.trim();
      const type = typeInput.value;
      const personType = personTypeInput.value;

      if (!value) return alert("ØªÚ©Ø§ÛŒÙ‡ Ú•ÛÚ˜Û•Ú©Û• Ø¨Ù†ÙˆÙˆØ³Û•");
      if (value < 20 || value > 600) return alert("ØªÚ©Ø§ÛŒÙ‡ Ú•ÛÚ˜Û•Ú©Û• Ù„Û•Ù†ÛÙˆØ§Ù† 20 Ùˆ 600 Ø¨Ù†ÙˆÙˆØ³Ù‡");

      const date = new Date().toLocaleString("ar-EG");
      const classification = getClassification(value, type, personType);

      const record = {
        value,
        type: type === "fasting" ? "Ø¨Û•Ú•Û†Ú˜ÙˆÙˆØ¨ÙˆÙˆÙ†" : "Ø¯ÙˆÙˆÚ©Ø§ØªÚ˜Ù…ÛØ± Ø¯ÙˆØ§ÛŒ Ù†Ø§Ù†",
        personType: personType === "healthy" ? "Ø´Û•Ú©Ø±Û•ÛŒ Ù†ÛŒÛŒÛ•" : "Ø´Û•Ú©Ø±Û•ÛŒ Ù‡Û•ÛŒÛ•",
        date,
        classification
      };

      let readings = JSON.parse(localStorage.getItem("sugarReadings")) || [];
      readings.push(record);
      localStorage.setItem("sugarReadings", JSON.stringify(readings));

      sugarInput.value = "";
      showReadings();
      updateChart();
    }

    function showReadings() {
      const readings = JSON.parse(localStorage.getItem("sugarReadings")) || [];
      recordsDiv.innerHTML = "";

      readings.reverse().forEach((r, i) => {
        const div = document.createElement("div");
        div.className = "record " + r.classification;
        div.innerHTML = `
          <span><strong>${r.value} mg/dL</strong> - ${r.type}</span>
          <span>ğŸ‘¤ ${r.personType}</span>
          <span>ğŸ“… ${r.date}</span>
          <span>${ r.classification === "low" ? "ğŸŸ  Ø´Û•Ú©Ø±Û•Øª Ù†Ø²Ù…Û•" :
                   r.classification === "normal" ? "ğŸŸ¢ Ø´Û•Ú©Ø±Û•Øª Ø¦Ø§Ø³Ø§ÛŒÛŒÛ•" :
                   r.classification === "prediabetes" ? "âš ï¸ Ù¾ÛØ´ Ø´Û•Ú©Ø±Û•" : "ğŸ”´ Ø´Û•Ú©Ø±Û•Øª Ø¨Û•Ø±Ø²Û•" }</span>
          <button class="delete-single" onclick="deleteReading(${readings.length - 1 - i})">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
        `;
        recordsDiv.appendChild(div);
      });
    }

    function deleteReading(index) {
      let readings = JSON.parse(localStorage.getItem("sugarReadings")) || [];
      readings.splice(index, 1);
      localStorage.setItem("sugarReadings", JSON.stringify(readings));
      showReadings();
      updateChart();
    }

    function clearAll() {
      if (confirm("Ø¦Ø§ÛŒÙ‡ ØªÛ† Ø¯ÚµÙ†ÛŒØ§ÛŒÛŒ Ù„Û•Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ØªÛ•ÙˆØ§ÙˆÛŒ ØªÛ†Ù…Ø§Ø±Û•Ú©Ø§Ù†ØŸ")) {
        localStorage.removeItem("sugarReadings");
        showReadings();
        updateChart();
      }
    }

    function updateChart() {
      const readings = JSON.parse(localStorage.getItem("sugarReadings")) || [];
      const labels = readings.map(r => r.date);
      const data = readings.map(r => parseInt(r.value));

      if(chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³ÙƒØ± (mg/dL)',
            data: data,
            fill: true,
            borderColor: '#00796b',
            backgroundColor: 'rgba(0,121,107,0.2)',
            tension: 0.3,
            pointBackgroundColor: '#004d40',
            pointRadius: 5
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true, position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              suggestedMax: 250
            }
          }
        }
      });
    }

    showReadings();
    updateChart();
  </script>
</body>
</html>
