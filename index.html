<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سجل و رسم بیانی شەکرە</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial,sans-serif; background:#f0f4f8; margin:0; padding:10px; color:#333; }
h1 { text-align:center; font-size:1.3rem; margin-bottom:10px; }
.container { max-width:400px; margin:auto; background:white; padding:10px; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
label, select, input { width:100%; margin-bottom:0.5rem; font-size:0.85rem; }
input, select { padding:0.3rem; border:1px solid #ccc; border-radius:5px; }
.btn { background:#3498db; color:white; border:none; padding:0.5rem; width:100%; border-radius:5px; font-size:0.85rem; margin-top:0.3rem; cursor:pointer; }
.btn:active { transform:scale(0.97); opacity:0.85; }
.btn.delete-all { background:#e74c3c; margin-top:0.3rem; }
.records { margin-top:5px; max-height:200px; overflow-y:auto; }
.record { padding:0.4rem; border-bottom:1px solid #ddd; font-size:0.8rem; position:relative; }
.record span { display:block; }
.low { color:orange; } .prediabetes { color:#d35400; } .normal { color:green; } .high { color:red; }
.delete-single { position:absolute; left:5px; top:5px; background:#e74c3c; color:white; border:none; border-radius:3px; padding:0.2rem 0.4rem; font-size:0.7rem; cursor:pointer; }
canvas { margin-top:10px; }
</style>
</head>
<body>
<div class="container">
<h1>سجل شەکرە و رسم بیانی</h1>

<label>شەکرەت هەیە؟</label>
<select id="personType"><option value="diabetic">بەڵێ</option><option value="healthy">نەخێر</option></select>

<label>بە(mg/dL) بنووسه</label>
<input type="number" id="sugar" placeholder="مثال: 110">

<label>دۆخ</label>
<select id="type"><option value="fasting">بەڕۆژووبوون</option><option value="postmeal">دووکاتژمێر دوای نان</option></select>

<button class="btn" onclick="saveReading()">💾 هەڵگردن</button>
<button class="btn delete-all" onclick="clearAll()">🗑️ سڕینەوە</button>

<div class="records" id="records"></div>

<canvas id="sugarChart" height="150"></canvas>
</div>

<script>
const sugarInput=document.getElementById("sugar");
const typeInput=document.getElementById("type");
const personTypeInput=document.getElementById("personType");
const recordsDiv=document.getElementById("records");
const ctx=document.getElementById("sugarChart").getContext("2d");

let chart;

function getClassification(value,type,personType){
value=parseInt(value);
let result='';
if(personType==="healthy"){
if(type==="fasting"){ if(value<70)result="low"; else if(value<=99)result="normal"; else if(value<=125)result="prediabetes"; else result="high"; }
else{ if(value<70)result="low"; else if(value<140)result="normal"; else if(value<=199)result="prediabetes"; else result="high"; }
}else{
if(type==="fasting"){ if(value<80)result="low"; else if(value<=130)result="normal"; else result="high"; }
else{ if(value<80)result="low"; else if(value<=180)result="normal"; else result="high"; }
}
return result;
}

function saveReading(){
const value=sugarInput.value.trim();
const type=typeInput.value;
const personType=personTypeInput.value;
if(!value){alert("تکایه ڕێژەکە بنووسە"); return;}
if(value<20||value>600){alert("تکایه ڕێژەکە لەنێوان 20 و 600 بنووسه"); return;}
const date=new Date().toLocaleString("ar-EG");
const classification=getClassification(value,type,personType);
const record={value,date,classification};
let readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
readings.push(record);
localStorage.setItem("sugarReadings",JSON.stringify(readings));
sugarInput.value="";
showReadings();
updateChart();
}

function showReadings(){
const readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
recordsDiv.innerHTML="";
readings.slice().reverse().forEach((r,i)=>{
const div=document.createElement("div");
div.className="record "+r.classification;
div.innerHTML=`<span><strong>${r.value} mg/dL</strong></span><span>📅 ${r.date}</span><span>${r.classification==="low"?"🟠 نزم":r.classification==="normal"?"🟢 ئاسایی":r.classification==="prediabetes"?"⚠️ پێش شەکرە":"🔴 بەرز"}</span><button class="delete-single" onclick="deleteReading(${readings.length-1-i})">سڕینەوە</button>`;
recordsDiv.appendChild(div);
});
}

function deleteReading(index){
let readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
readings.splice(index,1);
localStorage.setItem("sugarReadings",JSON.stringify(readings));
showReadings();
updateChart();
}

function clearAll(){
if(confirm("ئایه تۆ دڵنیایی لەسڕینەوەی تەواوی تۆمارەکان؟")){
localStorage.removeItem("sugarReadings");
showReadings();
updateChart();
}
}

function updateChart(){
const readings=JSON.parse(localStorage.getItem("sugarReadings"))||[];
const labels=readings.map(r=>r.date);
const data=readings.map(r=>r.value);
if(chart) chart.destroy();
chart=new Chart(ctx,{
type:'line',
data:{labels, datasets:[{label:'نسبه شەکرە', data, borderColor:'#3498db', backgroundColor:'rgba(52,152,219,0.2)', fill:true, tension:0.3}]},
options:{responsive:true, scales:{x:{display:true}, y:{display:true, beginAtZero:false}}}
});
}

showReadings();
updateChart();
</script>
</body>
</html>
